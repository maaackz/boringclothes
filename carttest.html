<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://js.stripe.com/v3"></script>
    <link rel="stylesheet" href="styles/main.css">
    <title>boring clothes</title>
</head>
<body>
    <div id="cursor" class="squiggly" style="position: absolute;left:-50vw;"><img class="cursor-img" src="images/cursor.svg" alt="" >
        <script src="scripts/cursor.js" defer></script>
    </div>

    <svg class = "animation" xmlns="http://www.w3.org/2000/svg" version="1.1">
        <defs>
            <filter id="squiggly-0">
                <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="0"/>
                <feDisplacementMap id="displacement" in="SourceGraphic" in2="noise" scale="3" />
            </filter>
            <filter id="squiggly-1">
                <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="1"/>
        <feDisplacementMap in="SourceGraphic" in2="noise" scale="6" />
            </filter>
            
            <filter id="squiggly-2">
                <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="2"/>
        <feDisplacementMap in="SourceGraphic" in2="noise" scale="3" />
            </filter>
            <filter id="squiggly-3">
                <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="3"/>
        <feDisplacementMap in="SourceGraphic" in2="noise" scale="6" />
            </filter>
            
            <filter id="squiggly-4">
                <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="4"/>
        <feDisplacementMap in="SourceGraphic" in2="noise" scale="3" />
            </filter>
        </defs> 
    </svg>

    <div id="header"></div>

    <main>
        <h1>cart</h1>
        <div class="cart-item">
            <div class="item-info">
                <img src="images/schoolkillsart-white.png" alt="">
                <span>
                    <h2>school kills art (t-shirt)</h2>
                    <p>$30.00</p>
                </span>
                <span>
                    <p>
                        color: black
                        <br>
                        size: L
                    </p>
                </span>
                <div>
                    <span>
                        <p>$30.00</p>
                        <section class="setting quantity nowrap">
                            <button class="minus" onclick="decrementQuantity()">-</button>
                            <p class="quantity-number">1</p>
                            <button class="plus" onclick="incrementQuantity()">+</button>
                        </section>
                        <img src="images/trash.svg" alt="trash can icon">
                    </span>
                </div>
            </div>
            <button id="checkout">checkout</button>
            <script>
                var priceIdMapping = {
                    'schoolkillsart-white-s': 'price_1Nrw3CCrkwaz05lrMHe7TrTE',
                    'schoolkillsart-white-m': 'price_1Nrw7lCrkwaz05lr68fYC2bE',
                    'schoolkillsart-white-l': 'price_1Nrw86Crkwaz05lrc3d9oz3F',
                    'schoolkillsart-white-xl': 'price_1Nrw8cCrkwaz05lrdm5RPI4Q',
                    'schoolkillsart-white-2xl': 'price_1NrwFpCrkwaz05lrIMVgBNxJ',
                    'schoolkillsart-black-s': 'price_1NrwCNCrkwaz05lr5cEU7d9q',
                    'schoolkillsart-black-m': 'price_1NrwCsCrkwaz05lrzVhqig8B',
                    'schoolkillsart-black-l': 'price_1NrwDKCrkwaz05lrX6OovyEc',
                    'schoolkillsart-black-xl': 'price_1NrwDgCrkwaz05lr9LZjL7HJ',
                    'schoolkillsart-black-2xl': 'price_1NrwE7Crkwaz05lrjClTN1cq'
                };
                
                var stripe = Stripe(
                    "pk_live_51NLHMyCrkwaz05lrF9080B65EFORO3Rm2TTgVnQt9DcRX1dotLhvHN62ZRHhh7IUM7WbwP2ffQFUPVm0wGTUwijK00wzqkpyGX"
                );
            
                document.getElementById("checkout").addEventListener("click", function () {
                    // Retrieve the cart from local storage
                    var cart = JSON.parse(localStorage.getItem('cart')) || [];
                    console.log(cart);
                    
                    // Create line items for the Stripe checkout
                    var lineItems = cart.map(function (cartItem) {
                        return {
                            price: priceIdMapping[cartItem.productId],
                            quantity: cartItem.quantity
                        };
                    });
                    
                    // Redirect to Stripe checkout with billing and shipping details
                    stripe.redirectToCheckout({
                        lineItems: lineItems,
                        mode: 'payment',
                        successUrl: "http://boringclothes.maaackz.com/success.html",
                        cancelUrl: "http://boringclothes.maaackz.com/cart.html",
                        billingAddressCollection: 'required',
                        shippingAddressCollection: {
                            allowedCountries: ['US']
                        }
                    }).then(function (result) {
                        // Handle the result if needed
                        if (result.error) {
                            alert(result.error.message);
                        }
                    });
                });
            </script>
            
            

        </div>
    </main>



    <div id="footer"></div>

    <script>
        $(function(){
            $("#header" ).load( "header.html" );
            $("#footer" ).load( "footer.html" );
        });
    </script>

    <!-- <script>
        let cart = []
        let string = JSON.stringify(cart)
        localStorage.setItem("cart", string)
    </script> -->


</body>
</html>

